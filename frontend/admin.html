<!DOCTYPE html>
<html>
<head>
  <title>Admin Panel - Sri Varahi Packers</title>

  <style>
    body {
      font-family: Arial;
      padding: 20px;
    }
    table {
      border-collapse: collapse;
      width: 100%;
      margin-top: 20px;
    }
    th, td {
      border: 1px solid #333;
      padding: 10px;
      text-align: center;
    }
    th {
      background-color: #f4f4f4;
    }
    button {
      padding: 6px 10px;
      cursor: pointer;
    }
  </style>
</head>
<body>

<script>
  // üîê SIMPLE ADMIN PASSWORD PROTECTION
  const ADMIN_PASSWORD = "admin123"; // change this

  const entered = prompt("Enter Admin Password:");
  if (entered !== ADMIN_PASSWORD) {
    alert("‚ùå Wrong password");
    window.location.href = "/";
  }
</script>

<h2>üì¶ Sri Varahi Packers & Movers - Bookings</h2>

<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Phone</th>
      <th>From</th>
      <th>To</th>
      <th>Date</th>
      <th>Created At</th>
      <th>Status</th>
      <th>Action</th>
    </tr>
  </thead>
  <tbody id="tableBody"></tbody>
</table>

<hr>

<h3>üîê Change Admin Password</h3>

<input type="password" id="oldPass" placeholder="Old Password"><br><br>
<input type="password" id="newPass" placeholder="New Password"><br><br>
<button onclick="changePassword()">Change Password</button>

<script>
  // ‚úÖ LOAD BOOKINGS (PRODUCTION SAFE)
  fetch("/bookings")
    .then(res => res.json())
    .then(data => {
      const table = document.getElementById("tableBody");
      table.innerHTML = "";

      data.forEach(b => {
        table.innerHTML += `
          <tr>
            <td>${b.name}</td>
            <td>${b.phone}</td>
            <td>${b.from}</td>
            <td>${b.to}</td>
            <td>${b.date}</td>
            <td>${new Date(b.createdAt).toLocaleString()}</td>
            <td>
              <select onchange="updateStatus('${b._id}', this.value)">
                <option value="Pending" ${b.status === "Pending" ? "selected" : ""}>Pending</option>
                <option value="Confirmed" ${b.status === "Confirmed" ? "selected" : ""}>Confirmed</option>
                <option value="Completed" ${b.status === "Completed" ? "selected" : ""}>Completed</option>
              </select>
            </td>
            <td>
              <button onclick="deleteBooking('${b._id}')">Delete</button>
            </td>
          </tr>
        `;
      });
    });

  // ‚úÖ DELETE BOOKING
  function deleteBooking(id) {
    if (!confirm("Are you sure?")) return;

    fetch(`/bookings/${id}`, { method: "DELETE" })
      .then(() => {
        alert("Booking deleted");
        location.reload();
      });
  }

  // ‚úÖ UPDATE STATUS
  function updateStatus(id, status) {
    fetch(`/bookings/${id}/status`, {
      method: "PUT",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ status })
    });
  }

  // ‚úÖ CHANGE ADMIN PASSWORD
  function changePassword() {
    const oldPassword = document.getElementById("oldPass").value;
    const newPassword = document.getElementById("newPass").value;

    fetch("/change-password", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ oldPassword, newPassword })
    })
    .then(res => res.json())
    .then(data => alert(data.message));
  }
</script>

</body>
</html>
